define(["jquery","DoughBaseComponent"],function(s,t){"use strict";var e,i={scrollThrottle:200,scrollLimit:700,hiddenClass:"mobile-webchat--hide"};return e=function(t,o){e.baseConstructor.call(this,t,o,i),this.chatPopupBtn=t,this.chatPopupIcon=t.find("[data-dough-webchat-icon]"),this.chatPopupClose=t.find("[data-dough-webchat-close]"),this.popupElements=t.children().not("[data-dough-webchat-icon]"),this.serviceSelect=t.find("[data-dough-webchat-select]"),this.whatsappBtn=t.find("[data-dough-webchat-button-whatsapp]"),this.webchatBtn=t.find("[data-dough-webchat-button-webchat]")},t.extend(e),e.componentName="ChatPopup",e.prototype._setupListeners=function(){var o=this;this.chatPopupIcon.click(function(t){t.preventDefault(),o._togglePopup(),o._manageTransition(1)}),this.chatPopupClose.click(function(t){t.preventDefault(),o._togglePopup(),o._manageTransition(0),o._setScrollLimits()}),this.serviceSelect.change(function(t){"debt-and-borrowing"===t.target.value||"pensions-and-retirement"===t.target.value?o.whatsappBtn.removeClass("is-hidden"):o.whatsappBtn.addClass("is-hidden")}),s(window).scroll(s.throttle(i.scrollThrottle,function(){o._hideChatPopup()&&o.chatPopupBtn.addClass(i.hiddenClass),o._reachedContactPanels()?o.chatPopupBtn.addClass("is-hidden"):o.chatPopupBtn.removeClass("is-hidden")})),this.chatPopupBtn.click(function(t){t.offsetX<20&&o.chatPopupBtn.hasClass(i.hiddenClass)&&(o.chatPopupBtn.removeClass(i.hiddenClass),o._setScrollLimits())})},e.prototype._setScrollLimits=function(){this.scrollLimitTop=this._getScrollAmount()-i.scrollLimit,this.scrollLimitBottom=this._getScrollAmount()+i.scrollLimit,this.scrollLimitTop<0&&(this.scrollLimitTop=0),this.contactPanelsOffset=s("[data-dough-contact-panels]").offset().top-s(window).innerHeight()},e.prototype._hideChatPopup=function(){if(!this.chatPopupBtn.hasClass(i.hiddenClass)&&this.chatPopupBtn.hasClass("mobile-webchat--closed"))return this._getScrollAmount()<this.scrollLimitTop||this._getScrollAmount()>this.scrollLimitBottom},e.prototype._reachedContactPanels=function(){return s(window).scrollTop()>this.contactPanelsOffset&&this.chatPopupBtn.hasClass(i.hiddenClass)},e.prototype._getScrollAmount=function(){return s(window).scrollTop()},e.prototype._manageTransition=function(e){var t=this;setTimeout(function(){s.each(t.popupElements,function(t,o){o.style.opacity=e,o.style.filter="alpha(opacity="+e+"00)"})},100)},e.prototype._togglePopup=function(){this.chatPopupBtn.toggleClass("mobile-webchat--opened").toggleClass("mobile-webchat--closed")},e.prototype._raisedChatPopup=function(t,o){t&&o?this.chatPopupBtn.addClass("mobile-webchat--raised"):this.chatPopupBtn.removeClass("mobile-webchat--raised")},e.prototype.init=function(t){this._setScrollLimits(),this._setupListeners(),this._initialisedSuccess(t)},e});