define(["jquery","DoughBaseComponent","eventsWithPromises"],function(s,t,i){"use strict";var e,o={selectors:{mainContent:".l-article-3col-main",parent:".l-article-3col-right"},classes:{fixed:"related-links--desktop-fixed",bottom:"related-links--desktop-bottom"}};return e=function(t,i){e.baseConstructor.call(this,t,i,o),this.contentHeight=0,this.topMargin=0,this.top=0,this.bottom=0,this.isFixed=!1,this.isAtBottom=!1,this.isInSidebar=!1,this.$parent=s(this.config.selectors.parent)},t.extend(e),e.componentName="StickyColumn",e.prototype.init=function(t){return this._initialisedSuccess(t),this._bindEvents(),this._measureDom(),this._showElement(),this._positionComponent(),this},e.prototype._bindEvents=function(){s(window).on("resize",this._debounce(s.proxy(this._handleResize,this),200)).on("scroll",s.proxy(this._handleScroll,this)),i.subscribe("toggler:toggled",s.proxy(this._handleSectionToggle,this))},e.prototype._isElementVisible=function(t){return t.is(":visible")},e.prototype._measureDom=function(){this.contentHeight=s(this.config.selectors.mainContent).height(),this.topMargin=parseInt(this.$parent.css("marginTop"),10),this.top=this.$parent.offset().top,this.bottom=this.top+this.contentHeight-this.topMargin-this.$el.height(),this.isInSidebar&&this._showInSidebar()},e.prototype._showElement=function(){if(!this.isInSidebar&&this._isElementVisible(this.$el))return this._showInSidebar(),void(this.isInSidebar=!0);this.isInSidebar&&!this._isElementVisible(this.$el)&&(this._hide(),this.isInSidebar=!1)},e.prototype._showInSidebar=function(){this.$parent.css("height",this.contentHeight-this.topMargin),this.$el.css("width",this.$parent.width())},e.prototype._hide=function(){this.$parent.css("height","auto")},e.prototype._positionComponent=function(){var t;if(this.isInSidebar){if(t=this._getWindowScroll(),!this.isFixed&&!this.isAtBottom&&t>this.top)return this.$el.addClass(this.config.classes.fixed),this.isFixed=!0,void this._positionComponent();if(this.isFixed){if(t<this.top)return this.$el.removeClass(this.config.classes.fixed),void(this.isFixed=!1);if(t>this.bottom)return this.$el.removeClass(this.config.classes.fixed).addClass(this.config.classes.bottom),this.isFixed=!1,void(this.isAtBottom=!0)}if(this.isAtBottom){if(t<this.bottom&&t>this.top)return this.$el.addClass(this.config.classes.fixed).removeClass(this.config.classes.bottom),void(this.isAtBottom=!1);t<this.top&&(this.$el.removeClass(this.config.classes.fixed).removeClass(this.config.classes.bottom),this.isAtBottom=!1,this.isFixed=!1)}}},e.prototype._getWindowScroll=function(){return s(window).scrollTop()},e.prototype._debounce=function(e,o){var n;return function(){var t=this,i=arguments,s=function(){n=null,e.apply(t,i)};clearTimeout(n),n=setTimeout(s,o)}},e.prototype._handleResize=function(){this._measureDom(),this._showElement(),this._positionComponent()},e.prototype._handleScroll=function(){this.isInSidebar&&this._positionComponent()},e.prototype._handleSectionToggle=function(t){0<t.emitter.$el.parents(this.$el).length&&(this._handleResize(),this._getWindowScroll()>this.bottom&&this._scrollToView())},e.prototype._scrollToView=function(){window.scrollTo(0,this.bottom-parseInt(this.$el.css("paddingTop")))},e});