define(["jquery","DoughBaseComponent","eventsWithPromises"],function(i,t,n){"use strict";var e,o={hideOnBlur:!1,forceTo:!1,oneGroupOpenOnly:!1,focusTarget:!0,showLabels:!1,iconPosition:"left",selectors:{trigger:"[data-dough-collapsable-trigger]",activeClass:"is-active",inactiveClass:"is-inactive",iconClassOpen:"icon--down-chevron-blue",iconClassClose:"icon--up-chevron-blue"},i18nStrings:{open:"Show",close:"Hide"}};return e=function(t,s){return e.baseConstructor.call(this,t,s,o),this.$triggers=this.$el.is(this.config.selectors.trigger)?this.$el:this.$el.find(this.config.selectors.trigger),this.$target=i('[data-dough-collapsable-target="'+this.$triggers.attr("data-dough-collapsable-trigger")+'"]'),this.groupName=this.$triggers.data("dough-collapsable-group"),this._setupAccessibility(),this.handleUIEventTracking=i.proxy(this.handleUIEventTracking,this),s&&s.forceTo&&this.toggle(s.forceTo,!1),this},t.extend(e),e.componentName="Collapsable",e.prototype._setupAccessibility=function(){var t="data-dough-collapsable-target-"+this.$target.attr("data-dough-collapsable-target");this.$triggers.addClass("collapsable--icon-"+this.config.iconPosition),this.$triggers.wrapInner('<button class="unstyled-button collapsable-button" type="button"/>'),this.$triggers.find("button").addClass("collapsable-button--"+(this.config.showLabels?"show":"hide")+"-label").prepend('<span data-dough-collapsable-icon class="collapsable__trigger-icon icon '+this.config.selectors.iconClassOpen+'"></span>').append('<span class="'+(this.config.showLabels?"collapsable-icon-label":"visually-hidden")+'" data-dough-collapsable-label>'+this.config.i18nStrings.open+"</span>").attr("aria-controls",t).attr("aria-expanded","false"),this.$target.attr("id",t),this.$target.addClass("collapsable__target--initialised"),this.$triggers=this.$triggers.find("button")},e.prototype.init=function(t){return this.isShown=!!this.$target.hasClass(this.config.selectors.activeClass),this.setListeners(!0),this._initialisedSuccess(t),this},e.prototype.setListeners=function(t){return this.$triggers[t?"on":" off"]("click",i.proxy(function(){this.config.oneGroupOpenOnly&&n.publish("toggler:close:"+this.groupName,this.$el),this.toggle()},this)),this.config.oneGroupOpenOnly&&n.subscribe("toggler:close:"+this.groupName,i.proxy(function(t){t.is(this.$el)||this.toggle("hide",!1)},this)),this},e.prototype.setTargetTrackingListeners=function(t){return i("body")[t?"on":"off"]("click touchend keyup",this.handleUIEventTracking),this},e.prototype.handleUIEventTracking=function(t){var s=i(t.target);return s.is(this.$triggers)||s.closest(this.$target).length||this.toggle("hide"),this},e.prototype.toggle=function(t,s){var i,e,o,a;return i=void 0!==t?"show"===t?"addClass":"removeClass":this.isShown?"removeClass":"addClass",this.isShown=!!this.$target[i](this.config.selectors.activeClass).hasClass(this.config.selectors.activeClass),this.$triggers[i](this.config.selectors.activeClass),!0===this.isShown?(e=this.config.i18nStrings.close,o="true",a=this.config.selectors.iconClassClose,!1!==s&&this.config.focusTarget&&this.$target.attr("tabindex",-1).focus(),this.config.hideOnBlur&&this.setTargetTrackingListeners(!0)):(e=this.config.i18nStrings.open,o="false",a=this.config.selectors.iconClassOpen,this.config.hideOnBlur&&this.setTargetTrackingListeners(!1)),this.$triggers.find("[data-dough-collapsable-label]").text(e),this.$triggers.attr("aria-expanded",o),this.$triggers.find("[data-dough-collapsable-icon]").removeClass(this.config.selectors.iconClassOpen+" "+this.config.selectors.iconClassClose).addClass(a),void 0===t&&n.publish("toggler:toggled",{emitter:this,visible:this.isShown}),this},e});