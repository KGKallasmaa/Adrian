define(["jquery","DoughBaseComponent","mediaQueries","utilities","common"],function(n,a,o,t){"use strict";var e;return e=function(a,t){e.baseConstructor.call(this,a,t),this.$globalNav=this.$el,this.$mobileNavButton=n(document).find("[data-dough-mobile-nav-button]"),this.$globalNavClumps=this.$el.find("[data-dough-nav-clumps]"),this.$globalNavClump=this.$el.find("[data-dough-nav-clump]"),this.$globalNavClumpHeading=this.$el.find("[data-dough-nav-clump-heading]"),this.$globalSubNavHeading=this.$el.find("[data-dough-subnav-heading]"),this.$globalSubNav=this.$el.find("[data-dough-subnav]"),this.$mobileNavClose=this.$el.find("[data-dough-mobile-nav-close]"),this.$mobileNavOverlay=n(document).find("[data-dough-mobile-nav-overlay]"),this.delay=250},a.extend(e),e.componentName="GlobalNav",e.prototype.init=function(a){return this._initialisedSuccess(a),this._setUpMobileInteraction(),this._setUpDesktopInteraction(),this._setUpMobileAnimation(),this._setUpKeyboardEvents(),this._bindEvents(),this},e.prototype._bindEvents=function(){this.$globalNav.removeClass("uninitialised"),n(window).on("resize",t.debounce(n.proxy(this._setUpMobileAnimation,this),100))},e.prototype._setUpKeyboardEvents=function(){var e=this;this.$globalNav.keydown(function(a){32!==a.which&&40!==a.which||a.preventDefault()}),this.$globalNav.keyup(function(a){var t;switch(t=0<n(a.target).parents("[data-dough-subnav]").length?"subnav":"top",a.which){case 9:"top"===t&&e._closeBlurredClumps(a.target);break;case 13:"top"===t&&(a.preventDefault(),e._openDesktopSubNav(a.target),e._moveFocusToSubNav(a.target));break;case 27:"subnav"===t&&(e._closeDesktopSubNav(n(a.target).parents("[data-dough-subnav]")),e._moveTopLevelFocus(a.target));break;case 32:a.preventDefault(),"top"===t&&e._openDesktopSubNav(a.target);break;case 37:e._moveTopLevelFocus(a.target,"left"),"subnav"===t&&e._closeDesktopSubNav(n(a.target).parents("[data-dough-subnav]"));break;case 38:"subnav"===t&&e._moveSubNavFocus(a.target,"up");break;case 39:e._moveTopLevelFocus(a.target,"right"),"subnav"===t&&e._closeDesktopSubNav(n(a.target).parents("[data-dough-subnav]"));break;case 40:"top"===t?n(a.target).parents("[data-dough-nav-clump]").hasClass("is-active")?e._moveFocusToSubNav(a.target):e._openDesktopSubNav(a.target):e._moveSubNavFocus(a.target,"down")}})},e.prototype._moveFocusToSubNav=function(a){var t=n(a).siblings("[data-dough-subnav]").find("[data-dough-subcategories]").find("a")[0];n(t).focus()},e.prototype._moveSubNavFocus=function(a,t){var e=n(a).parents("[data-dough-subcategories]").find("a"),o=n(e).index(a);"up"===t?0<o?e[o-1].focus():e[e.length-1].focus():o<e.length-1?e[o+1].focus():e[0].focus()},e.prototype._moveTopLevelFocus=function(a,t){var e=n(a).parents("[data-dough-nav-clump]"),o=n(e).siblings("[data-dough-nav-clump]"),s=n(o).first(),i=n(o).last();"left"===t?0<n(e).prev("[data-dough-nav-clump]").length?n(e).blur().prev().children("[data-dough-nav-clump-heading]").focus():n(i).children("[data-dough-nav-clump-heading]").focus():"right"===t?0<n(e).next("[data-dough-nav-clump]").length?n(e).blur().next().children("[data-dough-nav-clump-heading]").focus():n(s).children("[data-dough-nav-clump-heading]").focus():n(e).children("[data-dough-nav-clump-heading]").focus()},e.prototype._closeBlurredClumps=function(a){this.$globalNavClump.not(n(a).parents("[data-dough-nav-clump]")).removeClass("is-active")},e.prototype._setUpMobileAnimation=function(){o.atSmallViewport()?this.$globalNav.removeClass("no-transition"):this.$globalNav.addClass("no-transition")},e.prototype._setUpMobileInteraction=function(){var t=this;this.$mobileNavButton.click(function(a){a.preventDefault(),t._toggleMobileNav()}),this.$globalNavClumpHeading.click(function(a){o.atSmallViewport()&&(a.preventDefault(),t._toggleMobileSubNav(this))}),this.$globalSubNavHeading.click(function(a){a.preventDefault(),t._returnMobileNav(this)}),this.$mobileNavClose.click(function(a){a.preventDefault(),t._toggleMobileNav()}),this.$mobileNavOverlay.click(function(a){a.preventDefault(),t._toggleMobileNav()})},e.prototype._setUpDesktopInteraction=function(){var e=this;o.atSmallViewport()||n(document).on("touchstart",function(a){0==n(a.target).parents('[data-dough-component="GlobalNav"]').length&&e.$globalNavClump.removeClass("is-active")}),this.$globalNavClumpHeading.mouseenter(function(a){window.clearTimeout(e.timeout),e.timeout=window.setTimeout(function(){e._sendHoverAnalytics(n(a.target).text()),e._openDesktopSubNav(n(a.target).parents("[data-dough-nav-clump-heading]"))},e.delay)}).mousedown(function(a){a.preventDefault()}).on("touchstart",function(a){n(a.target).parents("[data-dough-nav-clump-heading]").off("mouseenter")}).on("touchend",function(a){if(!o.atSmallViewport()){var t=n(a.target).parents("[data-dough-nav-clump-heading]");n(a.target).parents("[data-dough-nav-clump]").hasClass("is-active")?e._closeDesktopSubNav(t):e._openDesktopSubNav(t)}}),this.$globalNav.mouseleave(function(){window.clearTimeout(e.timeout),e.closeNavTimeout=window.setTimeout(function(){e._closeDesktopSubNav()},e.delay)}).mouseenter(function(){window.clearTimeout(e.closeNavTimeout)})},e.prototype._toggleMobileNav=function(){this.$globalNav.toggleClass("is-active"),this.$mobileNavOverlay.toggleClass("is-active"),n("body").addClass("no-scroll"),this.$globalNav.hasClass("is-active")||(this.$globalNav.removeClass("is-active"),this.$mobileNavOverlay.removeClass("is-active"),this.$globalNavClumps.removeClass("is-active"),this.$globalNavClump.removeClass("is-active"),n("body").removeClass("no-scroll"))},e.prototype._toggleMobileSubNav=function(a){var t=n(a).siblings().get(0);n(a).parents("[data-dough-nav-clump]").toggleClass("is-active").parents("[data-dough-nav-clumps]").toggleClass("is-active"),n(t).removeClass("is-hidden")},e.prototype._returnMobileNav=function(a){n(a).parents("[data-dough-nav-clump]").toggleClass("is-active").parents("[data-dough-nav-clumps]").toggleClass("is-active"),setTimeout(function(){n("[data-dough-subnav]").addClass("is-hidden")},400)},e.prototype._openDesktopSubNav=function(a){this.$globalNav.hasClass("is-active")||(this.$globalSubNav.removeClass("is-active"),this.$globalNavClump.removeClass("is-active"),this.$globalNavClumpHeading.attr("aria-expanded","false"),n(a).attr("aria-expanded","true").parent("[data-dough-nav-clump]").addClass("is-active").siblings("[data-dough-subnav]").addClass("is-active"))},e.prototype._closeDesktopSubNav=function(a){this.$globalNav.hasClass("is-active")||(this.$globalSubNav.removeClass("is-active"),this.$globalNavClump.removeClass("is-active"),n(a).siblings("[data-dough-nav-clump-heading]").parents("[data-dough-nav-clump]").removeClass("is-active"))},e.prototype._sendHoverAnalytics=function(a){window.dataLayer.push({event:"gaEvent",gaEventCat:"Global Navigation",gaEventAct:"Hover",gaEventLab:a})},e});